# üß™ Plan Testowania Systemu SSPO v2.1.1

## üìã Spis tre≈õci
1. [Backend API Tests](#backend-api-tests)
2. [Frontend UI Tests](#frontend-ui-tests)
3. [Integration Tests](#integration-tests)
4. [Security Tests](#security-tests)
5. [Performance Tests](#performance-tests)
6. [Wyniki Test√≥w](#wyniki-test√≥w)

---

## üîß Backend API Tests

### 1. Authentication & Authorization

#### 1.1 POST /api/auth/register
**Test:** Rejestracja nowego u≈ºytkownika
```bash
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test-user@sspo.com.pl",
    "password": "TestPassword123!",
    "name": "Test User"
  }'
```
**Oczekiwany wynik:** 
- Status: 201
- Response: `{ "message": "U≈ºytkownik zarejestrowany", "userId": <id> }`

**Testy negatywne:**
- Kr√≥tkie has≈Ço (< 8 znak√≥w): `{ "error": "Has≈Ço musi mieƒá min. 8 znak√≥w" }`
- Duplikat email: `{ "error": "Email ju≈º istnieje" }`
- Brak wymaganych p√≥l: `{ "error": "<pole> jest wymagane" }`

#### 1.2 POST /api/auth/login
**Test:** Logowanie u≈ºytkownika
```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@sspo.com.pl",
    "password": "ChangeMe123!"
  }'
```
**Oczekiwany wynik:**
- Status: 200
- Response: `{ "token": "<JWT>", "user": { "id": 1, "email": "...", "name": "...", "role": "admin" } }`

**Testy negatywne:**
- B≈Çƒôdne has≈Ço: `{ "error": "Nieprawid≈Çowe dane logowania" }`
- NieistniejƒÖcy email: `{ "error": "Nieprawid≈Çowe dane logowania" }`

#### 1.3 GET /api/auth/me
**Test:** Pobranie aktualnego u≈ºytkownika
```bash
TOKEN="<JWT_TOKEN>"
curl http://localhost:3000/api/auth/me \
  -H "Authorization: Bearer $TOKEN"
```
**Oczekiwany wynik:**
- Status: 200
- Response: `{ "id": 1, "email": "...", "name": "...", "role": "admin" }`

**Testy negatywne:**
- Brak tokenu: `{ "error": "Brak tokenu autoryzacji" }`
- Nieprawid≈Çowy token: `{ "error": "Nieprawid≈Çowy token" }`

---

### 2. User Management

#### 2.1 GET /api/users (Admin only)
**Test:** Lista wszystkich u≈ºytkownik√≥w
```bash
curl http://localhost:3000/api/users \
  -H "Authorization: Bearer $ADMIN_TOKEN"
```
**Oczekiwany wynik:**
- Status: 200
- Response: Array u≈ºytkownik√≥w z polami: id, email, name, role, created_at, last_login

**Testy negatywne:**
- Jako viewer/contributor: `{ "error": "Brak uprawnie≈Ñ" }`

#### 2.2 PATCH /api/users/:id/role (Admin only)
**Test:** Zmiana roli u≈ºytkownika
```bash
curl -X PATCH http://localhost:3000/api/users/2/role \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{ "role": "reviewer" }'
```
**Oczekiwany wynik:**
- Status: 200
- Response: `{ "message": "Rola zaktualizowana" }`

**Testy negatywne:**
- Nieprawid≈Çowa rola: `{ "error": "Nieprawid≈Çowa rola" }`
- Jako non-admin: `{ "error": "Brak uprawnie≈Ñ" }`

#### 2.3 PATCH /api/users/me/password
**Test:** Zmiana w≈Çasnego has≈Ça
```bash
curl -X PATCH http://localhost:3000/api/users/me/password \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "currentPassword": "OldPassword123!",
    "newPassword": "NewPassword456!"
  }'
```
**Oczekiwany wynik:**
- Status: 200
- Response: `{ "message": "Has≈Ço zmienione pomy≈õlnie" }`

**Testy negatywne:**
- B≈Çƒôdne aktualne has≈Ço: `{ "error": "Nieprawid≈Çowe aktualne has≈Ço" }`
- Zbyt kr√≥tkie nowe has≈Ço: `{ "error": "Has≈Ço musi mieƒá min. 8 znak√≥w" }`

#### 2.4 PATCH /api/users/:id/reset-password (Admin only)
**Test:** Reset has≈Ça u≈ºytkownika
```bash
curl -X PATCH http://localhost:3000/api/users/2/reset-password \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{ "newPassword": "ResetPassword123!" }'
```
**Oczekiwany wynik:**
- Status: 200
- Response: `{ "message": "Has≈Ço zresetowane pomy≈õlnie" }`

---

### 3. Comments System

#### 3.1 GET /api/comments/:documentId
**Test:** Pobranie komentarzy do dokumentu
```bash
curl http://localhost:3000/api/comments/01-regulamin-sspo
```
**Oczekiwany wynik:**
- Status: 200
- Response: Array komentarzy z polami: id, document_id, paragraph_id, content, user_id, user_name, created_at, parent_id, replies

#### 3.2 POST /api/comments
**Test:** Dodanie nowego komentarza
```bash
curl -X POST http://localhost:3000/api/comments \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "documentId": "01-regulamin-sspo",
    "paragraphId": "section-1",
    "content": "To jest testowy komentarz"
  }'
```
**Oczekiwany wynik:**
- Status: 201
- Response: `{ "message": "Komentarz dodany", "commentId": <id> }`

**Wymagane role:** contributor, reviewer, admin

#### 3.3 POST /api/comments/:id/reply
**Test:** Odpowied≈∫ na komentarz
```bash
curl -X POST http://localhost:3000/api/comments/1/reply \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{ "content": "To jest odpowied≈∫ na komentarz" }'
```
**Oczekiwany wynik:**
- Status: 201
- Response: `{ "message": "Odpowied≈∫ dodana", "commentId": <id> }`

#### 3.4 PATCH /api/comments/:id
**Test:** Edycja komentarza (w≈Çasnego)
```bash
curl -X PATCH http://localhost:3000/api/comments/1 \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{ "content": "Zaktualizowana tre≈õƒá komentarza" }'
```
**Oczekiwany wynik:**
- Status: 200
- Response: `{ "message": "Komentarz zaktualizowany" }`

**Testy negatywne:**
- Edycja cudzego komentarza: `{ "error": "Brak uprawnie≈Ñ" }`

#### 3.5 DELETE /api/comments/:id
**Test:** Usuniƒôcie komentarza
```bash
curl -X DELETE http://localhost:3000/api/comments/1 \
  -H "Authorization: Bearer $TOKEN"
```
**Oczekiwany wynik:**
- Status: 200
- Response: `{ "message": "Komentarz usuniƒôty" }`

**Wymagania:** Tylko w≈Çasne komentarze lub admin

---

### 4. Amendments (Poprawki)

#### 4.1 GET /api/amendments
**Test:** Lista wszystkich poprawek
```bash
curl http://localhost:3000/api/amendments?status=pending
```
**Oczekiwany wynik:**
- Status: 200
- Response: Array poprawek z polami: id, document_id, title, description, proposed_changes, status, created_by, created_at

**Filtry:**
- `?status=draft|pending|approved|rejected`
- `?userId=<id>`
- `?documentId=<id>`

#### 4.2 GET /api/amendments/:id
**Test:** Szczeg√≥≈Çy pojedynczej poprawki
```bash
curl http://localhost:3000/api/amendments/1
```
**Oczekiwany wynik:**
- Status: 200
- Response: Pe≈Çne dane poprawki + votes (g≈Çosy)

#### 4.3 POST /api/amendments
**Test:** Utworzenie nowej poprawki
```bash
curl -X POST http://localhost:3000/api/amendments \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "documentId": "01-regulamin-sspo",
    "title": "Poprawka paragraf 5",
    "description": "Zmiana tre≈õci paragrafu 5",
    "proposedChanges": "Nowa tre≈õƒá paragrafu...",
    "justification": "Uzasadnienie zmiany..."
  }'
```
**Oczekiwany wynik:**
- Status: 201
- Response: `{ "message": "Poprawka utworzona", "amendmentId": <id> }`

**Wymagane role:** contributor, reviewer, admin

#### 4.4 PATCH /api/amendments/:id
**Test:** Edycja poprawki (tylko draft)
```bash
curl -X PATCH http://localhost:3000/api/amendments/1 \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Zaktualizowany tytu≈Ç",
    "description": "Zaktualizowany opis"
  }'
```
**Oczekiwany wynik:**
- Status: 200
- Response: `{ "message": "Poprawka zaktualizowana" }`

**Ograniczenia:**
- Tylko poprawki w statusie `draft`
- Tylko w≈Çasne poprawki

#### 4.5 PATCH /api/amendments/:id/status
**Test:** Zmiana statusu poprawki (reviewer/admin)
```bash
curl -X PATCH http://localhost:3000/api/amendments/1/status \
  -H "Authorization: Bearer $REVIEWER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{ "status": "pending" }'
```
**Oczekiwany wynik:**
- Status: 200
- Response: `{ "message": "Status zaktualizowany" }`

**Mo≈ºliwe statusy:**
- `draft` ‚Üí `pending` (autor)
- `pending` ‚Üí `approved` (reviewer/admin)
- `pending` ‚Üí `rejected` (reviewer/admin)

#### 4.6 POST /api/amendments/:id/vote
**Test:** G≈Çosowanie na poprawkƒô (reviewer/admin)
```bash
curl -X POST http://localhost:3000/api/amendments/1/vote \
  -H "Authorization: Bearer $REVIEWER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{ "vote": "for" }'
```
**Oczekiwany wynik:**
- Status: 201
- Response: `{ "message": "G≈Ços zarejestrowany" }`

**Typy g≈Ços√≥w:** `for`, `against`, `abstain`

---

### 5. Health & Status

#### 5.1 GET /health
**Test:** Health check
```bash
curl http://localhost:3000/health
```
**Oczekiwany wynik:**
- Status: 200
- Response: `{ "status": "healthy", "timestamp": "...", "uptime": 123.45 }`

---

## üé® Frontend UI Tests

### 1. Authentication UI

- [ ] **Login Form**
  - Wy≈õwietla siƒô poprawnie
  - Walidacja email (format)
  - Walidacja has≈Ça (min. 8 znak√≥w)
  - Pokazuje b≈Çƒôdy z API
  - Przekierowuje po zalogowaniu
  - "Zapamiƒôtaj mnie" dzia≈Ça

- [ ] **Register Form**
  - Wszystkie pola wymagane
  - Walidacja email
  - Walidacja has≈Ça (min. 8 znak√≥w)
  - Potwierdzenie has≈Ça
  - Pokazuje b≈Çƒôdy
  - Przekierowuje do logowania po rejestracji

### 2. Navigation & Layout

- [ ] **Toolbar**
  - Wy≈õwietla siƒô po zalogowaniu
  - Pokazuje nazwƒô u≈ºytkownika
  - Menu u≈ºytkownika dzia≈Ça (dropdown)
  - Przyciski nawigacji dzia≈ÇajƒÖ
  - Responsywny design (mobile)

- [ ] **Sidebar**
  - Lista dokument√≥w
  - Wyszukiwarka widoczna
  - Nawigacja dzia≈Ça
  - Aktywny dokument pod≈õwietlony

- [ ] **User Menu Dropdown**
  - üë§ Moje konto
  - üîë Zmie≈Ñ has≈Ço
  - ‚öôÔ∏è Panel administratora (tylko admin)
  - üìä Moja aktywno≈õƒá
  - ‚ÑπÔ∏è O systemie
  - üö™ Wyloguj

### 3. Comments System UI

- [ ] **Comment Display**
  - Komentarze wy≈õwietlajƒÖ siƒô przy paragrafach
  - Ikona üí¨ pokazuje liczbƒô komentarzy
  - Komentarze sƒÖ sortowane (najnowsze na g√≥rze)
  - Odpowiedzi sƒÖ wciƒôte
  - Data i autor widoczne

- [ ] **Add Comment**
  - Formularz dodawania dzia≈Ça
  - Textarea rozszerza siƒô
  - Przycisk "Dodaj komentarz" aktywny
  - Anulowanie dzia≈Ça
  - Komentarz pojawia siƒô natychmiast

- [ ] **Reply to Comment**
  - Przycisk "Odpowiedz" dzia≈Ça
  - Formularz odpowiedzi wy≈õwietla siƒô
  - Odpowied≈∫ jest wciƒôta
  - Threading dzia≈Ça (max 3 poziomy?)

- [ ] **Edit Comment**
  - Przycisk "Edytuj" tylko dla w≈Çasnych
  - Textarea z aktualnƒÖ tre≈õciƒÖ
  - Zapisanie aktualizuje komentarz
  - Anulowanie przywraca oryginalny

- [ ] **Delete Comment**
  - Przycisk "Usu≈Ñ" tylko dla w≈Çasnych/admin
  - Potwierdzenie usuniƒôcia
  - Komentarz znika z widoku

### 4. Amendments System UI

- [ ] **Amendments List**
  - Lista poprawek wy≈õwietla siƒô
  - Filtry dzia≈ÇajƒÖ (status, dokument)
  - Klikniƒôcie otwiera szczeg√≥≈Çy
  - Status kolorowo oznaczony

- [ ] **Create Amendment**
  - Formularz tworzenia dzia≈Ça
  - Wszystkie pola wymagane
  - Markdown preview (opcjonalnie)
  - Zapisanie jako draft
  - Submit do recenzji

- [ ] **Amendment Details**
  - Wy≈õwietla tytu≈Ç, opis, zmiany
  - Pokazuje autora i datƒô
  - G≈Çosy wy≈õwietlone (for/against/abstain)
  - Przyciski akcji widoczne (wed≈Çug roli)

- [ ] **Voting**
  - Przyciski g≈Çosowania (reviewer/admin)
  - ‚úÖ Za, ‚ùå Przeciw, ‚öñÔ∏è Wstrzymujƒô siƒô
  - G≈Ços zapisuje siƒô
  - Aktualizacja licznik√≥w

- [ ] **Review Actions** (reviewer/admin)
  - ‚úÖ Akceptuj
  - ‚ùå Odrzuƒá
  - üìù Za≈ºƒÖdaj zmian
  - Zmiana statusu dzia≈Ça

### 5. Admin Panel UI

- [ ] **User Management Tab**
  - Tabela u≈ºytkownik√≥w wy≈õwietla siƒô
  - Wszystkie kolumny widoczne
  - Dropdown zmiany roli dzia≈Ça
  - Przycisk üíæ zapisuje rolƒô
  - Przycisk üîë otwiera reset has≈Ça

- [ ] **Password Reset Modal**
  - Modal wy≈õwietla siƒô
  - Email u≈ºytkownika pokazany
  - Auto-generated has≈Ço
  - Edycja has≈Ça dzia≈Ça
  - Resetowanie zapisuje
  - Nowe has≈Ço wy≈õwietla siƒô adminowi

- [ ] **Statistics Tab**
  - Karty statystyk wy≈õwietlajƒÖ siƒô
  - Liczby poprawne
  - Gradientowe t≈Ço
  - Ostrze≈ºenie o domy≈õlnych danych

### 6. Password Management UI

- [ ] **Change Password Modal**
  - Otwiera siƒô z menu u≈ºytkownika
  - 3 pola: aktualne, nowe, potwierdzenie
  - Walidacja: min 8 znak√≥w
  - Walidacja: nowe === potwierdzenie
  - Pokazuje b≈Çƒôdy z API
  - Success notification
  - Zamyka siƒô po sukcesie

### 7. Search UI

- [ ] **Search Input**
  - Widoczna w sidebar
  - Placeholder "üîç Szukaj w dokumentach..."
  - Responsive width
  - Focus state dzia≈Ça

- [ ] **Search Results**
  - Wyniki wy≈õwietlajƒÖ siƒô
  - Pod≈õwietlone s≈Çowa kluczowe
  - Klikniƒôcie przenosi do dokumentu
  - "Brak wynik√≥w" gdy pusto

---

## üîó Integration Tests

### 1. Login ‚Üí Comments Flow
1. Zaloguj jako contributor
2. Otw√≥rz dokument
3. Dodaj komentarz
4. Sprawd≈∫ czy pojawi≈Ç siƒô
5. Od≈õwie≈º stronƒô ‚Üí komentarz nadal widoczny

### 2. Amendment Creation ‚Üí Review ‚Üí Approval
1. Zaloguj jako contributor
2. Utw√≥rz poprawkƒô (draft)
3. Submit do recenzji (pending)
4. Wyloguj, zaloguj jako reviewer
5. Zag≈Çosuj na poprawkƒô
6. Zaakceptuj poprawkƒô
7. Sprawd≈∫ czy status = approved

### 3. Admin User Management
1. Zaloguj jako admin
2. Otw√≥rz panel administratora
3. Zmie≈Ñ rolƒô u≈ºytkownika
4. Zresetuj has≈Ço u≈ºytkownika
5. Wyloguj jako admin
6. Zaloguj jako u≈ºytkownik z nowym has≈Çem

### 4. Search ‚Üí Navigation
1. Otw√≥rz stronƒô
2. Wpisz frazƒô w wyszukiwarkƒô
3. Kliknij wynik
4. Sprawd≈∫ czy przenosi do dokumentu
5. Sprawd≈∫ czy scroll do sekcji dzia≈Ça

---

## üîí Security Tests

### 1. Authorization Tests
- [ ] Viewer nie mo≈ºe dodawaƒá komentarzy
- [ ] Contributor nie mo≈ºe zmieniaƒá r√≥l
- [ ] Reviewer nie mo≈ºe resetowaƒá hase≈Ç
- [ ] Admin ma dostƒôp do wszystkiego

### 2. Token Tests
- [ ] Expired token ‚Üí 401
- [ ] Invalid token ‚Üí 401
- [ ] Missing token (protected route) ‚Üí 401
- [ ] Token refresh dzia≈Ça (je≈õli zaimplementowane)

### 3. SQL Injection Tests
- [ ] Komentarz z `'; DROP TABLE users; --`
- [ ] Email z SQL injection attempt
- [ ] Search query z SQL

### 4. XSS Tests
- [ ] Komentarz z `<script>alert('XSS')</script>`
- [ ] Nazwa u≈ºytkownika z HTML tags
- [ ] Amendment content z JavaScript

---

## ‚ö° Performance Tests

### 1. Backend Performance
- [ ] Health check < 50ms
- [ ] Login < 500ms
- [ ] Get comments < 200ms
- [ ] Create comment < 300ms
- [ ] Admin users list < 500ms

### 2. Frontend Performance
- [ ] Initial load < 3s
- [ ] Docsify render < 1s
- [ ] Comment load < 500ms
- [ ] Search results < 500ms

### 3. Database Performance
- [ ] Query execution < 100ms
- [ ] Database size < 100MB (monitoring)
- [ ] Indexes poprawne

---

## üìä Wyniki Test√≥w

### ‚úÖ PASSED (Do wype≈Çnienia po testach)
- [ ] Backend API - wszystkie endpointy
- [ ] Frontend UI - wszystkie komponenty
- [ ] Integration - flow end-to-end
- [ ] Security - authorization & validation
- [ ] Performance - response times

### ‚ùå FAILED (Problemy do naprawy)
- Lista problem√≥w...

### ‚ö†Ô∏è WARNINGS (Do uwagi)
- Lista ostrze≈ºe≈Ñ...

---

## üöÄ Automated Test Script

```bash
#!/bin/bash
# test-all.sh - Automated testing script

echo "üß™ Starting SSPO System Tests..."

# Backend Health
echo "1. Testing Backend Health..."
curl -f http://localhost:3000/health || echo "‚ùå Backend not responding"

# Login Test
echo "2. Testing Login..."
TOKEN=$(curl -s -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@sspo.com.pl","password":"ChangeMe123!"}' \
  | jq -r '.token')

if [ "$TOKEN" != "null" ]; then
  echo "‚úÖ Login successful"
else
  echo "‚ùå Login failed"
fi

# Get Users (Admin)
echo "3. Testing Get Users (Admin)..."
curl -s http://localhost:3000/api/users \
  -H "Authorization: Bearer $TOKEN" | jq '.[] | .email'

# More tests...

echo "üéâ Tests completed!"
```

---

**Ostatnia aktualizacja:** 2025-10-04  
**Autor:** lkolo-prez
